{% extends 'base.html' %}
{% block body %}
<main class="container">
  <h3>Issue – Volume {{ issue.volume }}, Issue {{ issue.number }} ({{ issue.year }})</h3>
  <p class="muted">Published: {{ issue.published_at.strftime('%Y-%m-%d') if issue.published_at else '—' }}</p>

  <section>
    <h4>Attached Articles</h4>
    {% if attached %}
      <ul class="list">
        {% for s in attached %}
        <li>
          <strong>{{ s.title }}</strong>
          <div class="muted">
            {{ s.authors_text or s.author.username }} ·
            {{ s.department or 'FACOMS' }} ·
            {{ s.created_at.strftime('%Y-%m-%d') }}
          </div>
          <form method="POST" action="{{ url_for('journal.admin_issue_detach', issue_id=issue.id) }}" style="margin-top:8px">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="submission_id" value="{{ s.id }}">
            <button class="btn">Detach</button>
          </form>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No articles attached yet.</p>
    {% endif %}
  </section>

  <hr>

  <section>
    <h4>Attach Accepted Articles (Ahead of Print)</h4>
    {% if available %}
      <div class="cards">
        {% for s in available %}
        <article class="card">
          <h4>{{ s.title }}</h4>
          <div class="meta">
            <span>{{ s.authors_text or s.author.username }}</span> ·
            <span>{{ s.department or 'FACOMS' }}</span> ·
            <span>{{ s.created_at.strftime('%Y-%m-%d') }}</span>
          </div>
          <p>{{ s.abstract[:180] }}{% if s.abstract|length > 180 %}…{% endif %}</p>
          <form method="POST" action="{{ url_for('journal.admin_issue_attach', issue_id=issue.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="submission_id" value="{{ s.id }}">
            <button class="btn btn-primary">Attach to this Issue</button>
          </form>
        </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No accepted, unassigned articles.</p>
    {% endif %}
  </section>

  <p style="margin-top:14px">
    <a class="btn" href="{{ url_for('journal.admin_issues') }}">← Back to Issues</a>
    <a class="btn" href="{{ url_for('public.issue_detail', year=issue.year, volume=issue.volume, number=issue.number) }}">View Public Page</a>
  </p>
</main>
{% endblock %}
